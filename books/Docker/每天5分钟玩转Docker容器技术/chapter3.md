## 第3章 Docker镜像
- base镜像
	- 不依赖其他镜像，从scratch构建
	- 其他镜像可以以之为基础进行扩展。
	- 所以，能称作base镜像的通常都是各种Linux发行版的Docker镜像。
- Linux操作系统由内核空间和用户空间组成
	- 内核空间是kernel， Linux刚启动时会加载bootfs文件系统，之后bootfs会被卸载掉。
	- 用户空间的文件系统是rootfs，包含我们熟悉的/dev、/proc、/bin等目录。
	- 对于base镜像来说，底层直接用Host的kernel，只需要提供rootfs。
- base镜像只是在用户空间与发行版一致，kernel版本与发行版是不同的。
- 容器只能使用Host的kernel，并且不能修改。
	- 所有容器都共用Host的kernel，在容器中没办法对kernel升级。
	- 如果容器对kernel版本有要求（比如应用只能在某个kernel版本下运行），则不建议用容器，这种场景虚拟机可能更合适。
- 镜像的分层结构
	- Docker支持通过扩展现有镜像，创建新的镜像。
	- 容器层记录对镜像的修改，所有的镜像层都是只读的。不会被容器修改，所以镜像可以被多个容器共享。
- 可写的容器层
	- 所有对容器的改动，无论添加、删除，还是修改文件都会只发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。
	- 只有当需要修改时才复制一份数据，这种特性被称作Copy-on-Write。可见，容器层保存的是镜像变化部分，不会对镜像本身进行任何修改。
	- 容器层记录对镜像的修改，所有镜像层都是只读的，不会被容器修改，所以镜像可以被多个容器共享。
- 构建镜像
	- docker commit
		- 运行容器
		- 修改容器
		- 将容器保存为新的镜像
	- Dockerfile 常用指令
		- `FROM` 指定 base镜像
		- `MAINTAINER` 设置镜像维护者
		- `COPY` 将文件从build context复制到镜像
		- `ADD` 与`COPY` 类似，不同的是，如果src是归档文件，文件会被自动解压到dest。
		- `ENV` 设置环境变量，环境变量可被后面的指令使用。
		- `EXPOSE` 指定容器中的进程会监听某个端口，Docker可以将该端口暴露出来。
		- `VOLUME` 将文件或目录声明为volume。
		- `WORKDIR` 为后面的RUN、CMD、ENTRYPOINT、ADD或COPY指令设置镜像中当前工作目录。
		- `RUN` 在容器中运行指定的命令。执行命令并创建新的镜像层，RUN经常用于安装软件包。
		- `CMD` 设置容器启动后默认执行的命令及参数。Dockerfile中可以有多个CMD命令，但只有最后一个生效。CMD可以被docker run之后的参数替换。
		- `ENTRYPOINT` 配置容器启动时运行的命令。Dockerfile中可以有多个ENTRYPOINT指令，但只有最后一个生效。
- 分发镜像
	- 保存和分发镜像的最直接的方法就是使用Docker Hub。
	- 搭建本地Registry